zookeepwe是什么？

官方定义：Apache ZooKeeper is an effort to develop and maintain an open-source server which enables highly reliable distributed coordination.  

关键词：distributed coordination。分布式协调器。  

协调什么？  
分布式服务。  
为什么分布式服务需要协调？  


Paxos是一个算法，用来保证分布式一致性，准确的讲是最终一致性。就是说并不能保证所有进程每一时刻值都是一致的，所有进程会在某一时刻就某个值达成一致。（需要注意的是某个时刻达成一致并不等价于该时刻所有进程的本地的值都相同，有一个原因是进程可能挂掉，你不能要求挂掉的进程做任何事；更像是最终所有存活的进程本地v的值都会相同。）  

三个基本前提：  
1. 达成的值是由某个进程提出的，不能是事先预置的，否则就没有意义。  
2. 一旦达成一致，就不能再对另一个值达成一致，这是安全性保证。
3. 一致性总能达成。不能无限制协商下去。

什么叫达成一致？  
多数（超过一半）的进程认为值是同一个值。  

Paxos中进程之间是平等的，即不存在一个特殊的进程，这是由于如果协议依赖于某个特殊的进程，那么这个进程挂掉势必会影响协议;而对于分布式环境，无法保证单个进程必然必活，能够容忍一定数量的进程挂掉，是分布式协议的必然要求。这是推导过程所要遵循的一个原则，称为平等性原则。

消息是进程间通信的唯一手段，对于分布式环境来说，这是显然的。

Paxos要求满足的前置假设只有一个：消息内容不会被篡改




## CAP定理  
任何分布式系统在可用性A、一致性C、分区容错性P方面，不能兼得，最多只能得其二。在分布式场景下，P自然是必选的，没有P算什么分布式系统。有多个分区，分区之间消息传递，面对不可靠的网络环境就一定存在丢包，那么就不能保证强一致性P。要保证强一致性P，就只能使用同步（已经有证明异步通信中不存在任何一致性的分布式算法），而同步又会导致在多台节点的分布式环境下延时会很大，这就导致了不可用。  

CP without A：如果不要求A（可用），相当于每个请求都需要在Server之间强一致，而P（分区）会导致同步时间无限延长，如此CP也是可以保证的。很多传统的数据库分布式事务都属于这种模式。  
AP wihtout C：要高可用并允许分区，则需放弃一致性。一旦分区发生，节点之间可能会失去联系，为了高可用，每个节点只能用本地数据提供服务，而这样会导致全局数据的不一致性。现在众多的NoSQL都属于此类。  

但是，要知道定理只是定理，现实应用场景下，总是有很多折衷。一致性有不同的程度，可用性也分不同等级。所以在具体的工程实践中，根据业务需要，放宽对AC的要求，是可以某种程度上兼得的。  


CAP定理证明中的一致性指强一致性，强一致性要求多节点组成的被调要能像单节点一样运作、操作具备原子性，数据在时间、时序上都有要求。如果放宽这些要求，还有其他一致性类型：

- 序列一致性(sequential consistency)[13]：不要求时序一致，A操作先于B操作，在B操作后如果所有调用端读操作得到A操作的结果，满足序列一致性  
- 最终一致性(eventual consistency)[14]：放宽对时间的要求，在被调完成操作响应后的某个时间点，被调多个节点的数据最终达成一致

延时与数据一致性也是一对“冤家”，如果要达到强一致性、多个副本数据一致，必然增加延时。